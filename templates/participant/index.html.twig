{% extends 'base.html.twig' %}

{% block title %}Gestion des participants
{% endblock %}

{% block body %}
	<div
		class="container mt-4">
		{# En-tête avec statistiques #}
		<div class="row mb-4">
			<div class="col-md-8">
				<div class="d-flex align-items-center">
					<div class="me-3">
						<i class="fas fa-users fa-2x text-info"></i>
					</div>
					<div>
						<h1 class="h2 mb-1">Gestion des participants</h1>
						<p class="text-muted mb-0">Administrez tous les participants à vos événements</p>
					</div>
				</div>
			</div>
		</div>

		{# Barre d'actions #}

		{% if participants|length > 0 %}
			{# Tri des participants : actifs d'abord #}
			{% set participants_actifs_list = [] %}
			{% set participants_inactifs = [] %}
			{% for participant in participants %}
				{% if participant.evenements|length > 0 %}
					{% set participants_actifs_list = participants_actifs_list|merge([participant]) %}
				{% else %}
					{% set participants_inactifs = participants_inactifs|merge([participant]) %}
				{% endif %}
			{% endfor %}

			{# Section des participants actifs #}
			{% if participants_actifs_list|length > 0 %}
				<section class="mb-5">
					<div class="d-flex align-items-center mb-3">
						<h3 class="h4 mb-0">
							<span class="badge bg-success me-2">{{ participants_actifs_list|length }}</span>
							Participants actifs
						</h3>
					</div>
					<div class="row">
						{% for participant in participants_actifs_list %}
							<div class="col-md-6 col-lg-4 mb-4">
								<div class="card h-100 shadow-sm border-start border-success border-3">
									<div class="card-header bg-success bg-gradient text-white">
										<div class="d-flex justify-content-between align-items-center">
											<h6 class="card-title mb-0">
												<i class="fas fa-user-check"></i>
												{{ participant.prenom }}
												{{ participant.nom }}
											</h6>
											<span class="badge bg-light text-dark">
												{{ participant.evenements|length }}
											</span>
										</div>
									</div>
									<div class="card-body">
										<div class="mb-3">
											<small class="text-muted">
												<i class="fas fa-envelope"></i>
												<a href="mailto:{{ participant.email }}" class="text-decoration-none">
													{{ participant.email }}
												</a>
											</small>
										</div>

										<div class="mb-3">
											<h6 class="text-success mb-2">
												<i class="fas fa-calendar-check"></i>
												Événements inscrits ({{ participant.evenements|length }})
											</h6>
											{% if participant.evenements|length > 0 %}
												<div class="small">
													{% for evenement in participant.evenements|slice(0, 2) %}
														<span class="badge bg-light text-dark mb-1">
															{{ evenement.titre }}
														</span>
													{% endfor %}
													{% if participant.evenements|length > 2 %}
														<span class="text-muted">
															+{{ participant.evenements|length - 2 }}
															autre(s)
														</span>
													{% endif %}
												</div>
											{% endif %}
										</div>

										{# Prochain événement #}
										{% set prochain_evenement = null %}
										{% for evenement in participant.evenements %}
											{% if evenement.date >= date() %}
												{% if prochain_evenement is null or evenement.date < prochain_evenement.date %}
													{% set prochain_evenement = evenement %}
												{% endif %}
											{% endif %}
										{% endfor %}

										{% if prochain_evenement %}
											<div class="alert alert-info py-2 mb-0">
												<small>
													<i class="fas fa-clock"></i>
													<strong>Prochain :</strong>
													{{ prochain_evenement.titre }}<br>
													{{ prochain_evenement.date|date('d/m/Y à H:i') }}
												</small>
											</div>
										{% endif %}
									</div>
									<div class="card-footer bg-white">
										<div class="btn-group w-100" role="group">
											<a href="{{ path('app_participant_show', {'id': participant.id}) }}" class="btn btn-outline-success btn-sm">
												<i class="fas fa-eye"></i>
												Profil
											</a>
											<a href="{{ path('app_participant_edit', {'id': participant.id}) }}" class="btn btn-outline-primary btn-sm">
												<i class="fas fa-edit"></i>
												Modifier
											</a>
										</div>
									</div>
								</div>
							</div>
						{% endfor %}
					</div>
				</section>
			{% endif %}

			{# Section des participants inactifs #}
			{% if participants_inactifs|length > 0 %}
				<section class="mb-4">
					<div class="d-flex align-items-center mb-3">
						<h3 class="h4 mb-0">
							<span class="badge bg-warning text-dark me-2">{{ participants_inactifs|length }}</span>
							Participants non inscrits
						</h3>
					</div>
					<div class="row">
						{% for participant in participants_inactifs %}
							<div class="col-md-6 col-lg-4 mb-4">
								<div class="card h-100 shadow-sm border-start border-warning border-3">
									<div class="card-header bg-warning text-dark">
										<div class="d-flex justify-content-between align-items-center">
											<h6 class="card-title mb-0">
												<i class="fas fa-user-minus"></i>
												{{ participant.prenom }}
												{{ participant.nom }}
											</h6>
											<span class="badge bg-secondary">
												<i class="fas fa-times"></i>
												0
											</span>
										</div>
									</div>
									<div class="card-body">
										<div class="mb-3">
											<small class="text-muted">
												<i class="fas fa-envelope"></i>
												<a href="mailto:{{ participant.email }}" class="text-decoration-none">
													{{ participant.email }}
												</a>
											</small>
										</div>

										<div class="alert alert-warning py-2">
											<small>
												<i class="fas fa-exclamation-triangle"></i>
												Ce participant n'est inscrit à aucun événement
											</small>
										</div>
									</div>
									<div class="card-footer bg-white">
										<div class="btn-group w-100" role="group">
											<a href="{{ path('app_participant_show', {'id': participant.id}) }}" class="btn btn-outline-warning btn-sm">
												<i class="fas fa-eye"></i>
												Profil
											</a>
											<a href="{{ path('app_participant_edit', {'id': participant.id}) }}" class="btn btn-outline-primary btn-sm">
												<i class="fas fa-user-edit"></i>
												Inscrire
											</a>
										</div>
									</div>
								</div>
							</div>
						{% endfor %}
					</div>
				</section>
			{% endif %}

			{# Bouton pour ajouter un nouveau participant #}

		{% else %}
			<div class="row justify-content-center">
				<div class="col-md-8">
					<div class="card border-0 shadow-sm">
						<div class="card-body text-center py-5">
							<div class="mb-4">
								<i class="fas fa-user-slash fa-4x text-muted"></i>
							</div>
							<p class="text-muted mb-4">
								Vous n'avez pas encore ajouté de participants. 
								                                Commencez par enregistrer vos premiers participants pour vos événements !
							</p>
							<div class="d-grid gap-2 d-md-block">
								<a href="{{ path('app_participant_new') }}" class="btn btn-info btn-lg">
									<i class="fas fa-user-plus"></i>
									Ajouter mon premier participant
								</a>
								<a href="{{ path('homepage') }}" class="btn btn-outline-primary btn-lg">
									<i class="fas fa-home"></i>
									Retour à l'accueil
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		{% endif %}
	</div>
{% endblock %}
